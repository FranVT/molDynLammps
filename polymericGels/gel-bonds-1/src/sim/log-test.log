LAMMPS (22 Jul 2025)
OMP_NUM_THREADS environment is not set. Defaulting to 1 thread.
  using 1 OpenMP thread(s) per MPI task
package omp 0
using multi-threaded neighbor list subroutines
# Input Script of lammps for assembly simulation of polimeric network.
# Main code is based on: https://github.com/PipeB62/Hydrogel-Simulation
# Patchy particles are with bond style.

# Felipe Benavides modified by Fco. Vazquez

# Initialization
units lj
dimension 3
boundary p p p

# Styles of atoms and that stuff
atom_style full
bond_style harmonic
angle_style harmonic
pair_style hybrid/overlay zero 0.0 lj/cut/omp 1.12 table/omp linear 5000000 threebody/table

newton on

# Create simulaiton box
region simulation_box block -$L $L -$L $L -$L $L
region simulation_box block -5.211203 $L -$L $L -$L $L
region simulation_box block -5.211203 5.211203 -$L $L -$L $L
region simulation_box block -5.211203 5.211203 -5.211203 $L -$L $L
region simulation_box block -5.211203 5.211203 -5.211203 5.211203 -$L $L
region simulation_box block -5.211203 5.211203 -5.211203 5.211203 -5.211203 $L
region simulation_box block -5.211203 5.211203 -5.211203 5.211203 -5.211203 5.211203
# N-atom-types region-ID keyword value Is necesesary the extra/special/per/atom (# of special neighbors per atom)
create_box 4 simulation_box     bond/types 1     angle/types 2     extra/bond/per/atom 10     extra/angle/per/atom 6     extra/special/per/atom 10
Created orthogonal box = (-5.211203 -5.211203 -5.211203) to (5.211203 5.211203 5.211203)
  1 by 1 by 1 MPI processor grid

# Atom types
mass 1 1.0      # CL
mass 2 1.0      # MO
mass 3 0.1      # PA
mass 4 0.1      # PB

# Coefficients
include potential.in
# Script with the pair-wise interaction and bonds between particles

bond_coeff 1 100.0 0.45
angle_coeff 1 100.0 180
angle_coeff 2 100.0 109.4712
pair_coeff 1 3 zero 0.5
pair_coeff 1 4 zero 0.5
pair_coeff 2 3 zero 0.5
pair_coeff 2 4 zero 0.5
pair_coeff 3 3 zero 0.5
pair_coeff 1 1 lj/cut/omp 1.0 1.0 1.12
pair_coeff 2 2 lj/cut/omp 1.0 1.0 1.12
pair_coeff 1 2 lj/cut/omp 1.0 1.0 1.12
pair_coeff 3 4 table/omp sysFiles/pachTab.table POT 0.6 # sw/omp sysFiles/patchyPot.sw NULL NULL PA PB
Reading pair table potential file sysFiles/pachTab.table with DATE: 2024-07-08
WARNING: 7 of 1000000 force values in table POT are inconsistent with -dE/dr.
WARNING:  Should only be flagged at inflection points (src/pair_table.cpp:469)
pair_coeff 4 4 table/omp sysFiles/pachTab.table POT 0.6 # sw/omp sysFiles/patchyPot.sw NULL NULL PA PB
Reading pair table potential file sysFiles/pachTab.table with DATE: 2024-07-08
WARNING: 7 of 1000000 force values in table POT are inconsistent with -dE/dr.
WARNING:  Should only be flagged at inflection points (src/pair_table.cpp:469)
pair_coeff * * threebody/table swapMech.3b NULL NULL PA PB
pair_modify pair lj/cut/omp shift yes


# Molecules
include molecules.in
# Script with all molecule information and create groups for computes

# Read the molecule information
molecule CL sysFiles/molecule.patchy.CL
Read molecule template CL:
# Patchy Cross-Linker
  1 molecules
  0 fragments
  0 bodies
  5 atoms with max type 3
  4 bonds with max type 1
  6 angles with max type 2
  0 dihedrals with max type 0
  0 impropers with max type 0
molecule MO sysFiles/molecule.patchy.MO
Read molecule template MO:
# Patchy Monomer
  1 molecules
  0 fragments
  0 bodies
  3 atoms with max type 4
  2 bonds with max type 1
  1 angles with max type 1
  0 dihedrals with max type 0
  0 impropers with max type 0

# Introduce the molecules
# ID style args keyword arg
region spawn_box block -$L $L -$L $L -$L $L
region spawn_box block -5.211203 $L -$L $L -$L $L
region spawn_box block -5.211203 5.211203 -$L $L -$L $L
region spawn_box block -5.211203 5.211203 -5.211203 $L -$L $L
region spawn_box block -5.211203 5.211203 -5.211203 5.211203 -$L $L
region spawn_box block -5.211203 5.211203 -5.211203 5.211203 -5.211203 $L
region spawn_box block -5.211203 5.211203 -5.211203 5.211203 -5.211203 5.211203

# create_atoms type style args keyword values
# style_random: N seed region-ID
# keyword_mol: template-ID seed
# keyword_overlap: overlap value = only insert if at least this distance from all existing atoms
# keyword_maxtry: maxtry value = number of attempts to insert a particle before failure
create_atoms 0 random ${NCL} ${seed1} spawn_box mol CL ${seed1} overlap 1.0 maxtry 5000 #xls
create_atoms 0 random 10 ${seed1} spawn_box mol CL ${seed1} overlap 1.0 maxtry 5000 
create_atoms 0 random 10 3234 spawn_box mol CL ${seed1} overlap 1.0 maxtry 5000 
create_atoms 0 random 10 3234 spawn_box mol CL 3234 overlap 1.0 maxtry 5000 
Created 50 atoms
  using lattice units in orthogonal box = (-5.211203 -5.211203 -5.211203) to (5.211203 5.211203 5.211203)
  create_atoms CPU = 0.001 seconds
create_atoms 0 random ${NMO} ${seed2} spawn_box mol MO ${seed2} overlap 1.0 maxtry 5000 #mon
create_atoms 0 random 90 ${seed2} spawn_box mol MO ${seed2} overlap 1.0 maxtry 5000 
create_atoms 0 random 90 6321 spawn_box mol MO ${seed2} overlap 1.0 maxtry 5000 
create_atoms 0 random 90 6321 spawn_box mol MO 6321 overlap 1.0 maxtry 5000 
Created 270 atoms
  using lattice units in orthogonal box = (-5.211203 -5.211203 -5.211203) to (5.211203 5.211203 5.211203)
  create_atoms CPU = 0.002 seconds

# Create patchy particles
group CrossLinker type 1 3
50 atoms in group CrossLinker
group Monomer type 2 4
270 atoms in group Monomer
group Patches type 3 4
220 atoms in group Patches
group CL type 1
10 atoms in group CL
group MO type 2
90 atoms in group MO
group PA type 3
40 atoms in group PA
group CM type 1 2
100 atoms in group CM

# Neighbor list
neighbor 1.8 bin # extra-distance style
#neigh_modify delay 0 every 1 check no
#neigh_modify exclude molecule/intra CrossLinker
#neigh_modify exclude molecule/intra Monomer

# COMPUTES

# Compute global kinetic and potential energy and temperature
compute t all temp
compute p all pressure t
compute ep all pe
compute ek all ke
variable eT equal etotal
variable eB equal ebond
variable eA equal eangle
variable H equal enthalpy
variable eM equal emol
variable ec equal ecouple
variable eC equal econserve

# Potencial energy per pair-wise interaction
compute wcaPair all pair lj/cut/omp epair
compute patchPair all pair table/omp epair
compute swapPair all pair threebody/table epair

# Compute the pressure
compute press all pressure t ke virial
compute pressVirial all pressure t virial
compute pressVirialMod all pressure t pair bond angle

# Computes for the stress
compute cstress all stress/atom t ke pair bond angle
compute cstressVirial all stress/atom t virial
compute cstressVirialMod all stress/atom t pair bond angle
compute stress all reduce sum c_cstress[*]
compute stressVirial all reduce sum c_cstressVirial[*]
compute stressVirialMod all reduce sum c_cstressVirialMod[*]

# Displacement of the central particles
compute disp CM displace/atom
compute redDisp CM reduce ave c_disp[*] # All, because yes

# Get the number of central particles per cluster
compute clusters all aggregate/atom 0.6                             # Create the clusters
compute Nclpart CM chunk/atom c_clusters compress yes discard yes   # Get the number of clusters
compute clsize CM property/chunk Nclpart count                      # Counts the atoms in each chunk
compute idcl CM property/chunk Nclpart id                           # Get the ids of the clusters

# Discretize the height into small boxes
#compute spatialChunks CM chunk/atom bin/3d x lower 1 y lower 1 z center ${bin_y} nchunk every units reduced

# DUMPS and FIXES

thermo ${NsaveStress}
thermo 1000

# Save global energies and temperature
fix Energy all ave/time 1 ${Nsave} ${Nsave} c_t c_wcaPair c_patchPair c_swapPair c_ep c_ek v_eT v_ec v_eC c_p v_eB v_eA v_eM v_H c_redDisp[*] file ${Dir}/${file1_name}
fix Energy all ave/time 1 1000 ${Nsave} c_t c_wcaPair c_patchPair c_swapPair c_ep c_ek v_eT v_ec v_eC c_p v_eB v_eA v_eM v_H c_redDisp[*] file ${Dir}/${file1_name}
fix Energy all ave/time 1 1000 1000 c_t c_wcaPair c_patchPair c_swapPair c_ep c_ek v_eT v_ec v_eC c_p v_eB v_eA v_eM v_H c_redDisp[*] file ${Dir}/${file1_name}
fix Energy all ave/time 1 1000 1000 c_t c_wcaPair c_patchPair c_swapPair c_ep c_ek v_eT v_ec v_eC c_p v_eB v_eA v_eM v_H c_redDisp[*] file /home/franvt/GitRepos/molDynLammps/polymericGels/gel-bonds-1/data/0.050.40.1100-2026-01-15-134529/${file1_name}
fix Energy all ave/time 1 1000 1000 c_t c_wcaPair c_patchPair c_swapPair c_ep c_ek v_eT v_ec v_eC c_p v_eB v_eA v_eM v_H c_redDisp[*] file /home/franvt/GitRepos/molDynLammps/polymericGels/gel-bonds-1/data/0.050.40.1100-2026-01-15-134529/system_assembly.fixf

# Save Pressure and Stress tensor
fix fixStress5 all ave/time 1 ${NsaveStress} ${NsaveStress} c_p c_press[*] c_pressVirial[*] c_pressVirialMod[*] c_stress[*] c_stressVirial[*] c_stressVirialMod[*] file ${Dir}/${file2_name}
fix fixStress5 all ave/time 1 1000 ${NsaveStress} c_p c_press[*] c_pressVirial[*] c_pressVirialMod[*] c_stress[*] c_stressVirial[*] c_stressVirialMod[*] file ${Dir}/${file2_name}
fix fixStress5 all ave/time 1 1000 1000 c_p c_press[*] c_pressVirial[*] c_pressVirialMod[*] c_stress[*] c_stressVirial[*] c_stressVirialMod[*] file ${Dir}/${file2_name}
fix fixStress5 all ave/time 1 1000 1000 c_p c_press[*] c_pressVirial[*] c_pressVirialMod[*] c_stress[*] c_stressVirial[*] c_stressVirialMod[*] file /home/franvt/GitRepos/molDynLammps/polymericGels/gel-bonds-1/data/0.050.40.1100-2026-01-15-134529/${file2_name}
fix fixStress5 all ave/time 1 1000 1000 c_p c_press[*] c_pressVirial[*] c_pressVirialMod[*] c_stress[*] c_stressVirial[*] c_stressVirialMod[*] file /home/franvt/GitRepos/molDynLammps/polymericGels/gel-bonds-1/data/0.050.40.1100-2026-01-15-134529/stress_assembly.fixf

# Save the global cluster information
fix 1 CM ave/time 1 1 ${Ndump} c_idcl c_clsize file ${Dir}/${file3_name} mode vector
fix 1 CM ave/time 1 1 1000000 c_idcl c_clsize file ${Dir}/${file3_name} mode vector
fix 1 CM ave/time 1 1 1000000 c_idcl c_clsize file /home/franvt/GitRepos/molDynLammps/polymericGels/gel-bonds-1/data/0.050.40.1100-2026-01-15-134529/${file3_name} mode vector
fix 1 CM ave/time 1 1 1000000 c_idcl c_clsize file /home/franvt/GitRepos/molDynLammps/polymericGels/gel-bonds-1/data/0.050.40.1100-2026-01-15-134529/clust_assembly.fixf mode vector

# The ave/chunk creates a temporal average. The ave keyword creates a spatial average.
#fix fixChunks CM ave/chunk 1 ${Nsave} ${Nsave} spatialChunks vx vy vz c_disp[*] ave one file ${Dir}/${file4_name}

# Save atom positions with cluster id
dump dumpID all custom ${Ndump} ${Dir}/traj/${file5_name} id mol c_clusters type x y z vx vy vz
dump dumpID all custom 1000000 ${Dir}/traj/${file5_name} id mol c_clusters type x y z vx vy vz
dump dumpID all custom 1000000 /home/franvt/GitRepos/molDynLammps/polymericGels/gel-bonds-1/data/0.050.40.1100-2026-01-15-134529/traj/${file5_name} id mol c_clusters type x y z vx vy vz
dump dumpID all custom 1000000 /home/franvt/GitRepos/molDynLammps/polymericGels/gel-bonds-1/data/0.050.40.1100-2026-01-15-134529/traj/traj_assembly.*.dumpf id mol c_clusters type x y z vx vy vz
dump_modify dumpID pbc yes # remap atoms via periodic boundary conditions

# RUN SIMULATION

# Brownian Dynamics using Langevin Thermostat

timestep ${tstep}
timestep 0.001

fix VelVerlet all nve # Use Velocity Verlet integrator

# First elevate the temperature
fix ThermoLng all langevin 0.0 ${temp} ${damp} ${seed3} # Brownian Dynamics: langevin + nve
fix ThermoLng all langevin 0.0 0.05 ${damp} ${seed3} 
fix ThermoLng all langevin 0.0 0.05 1 ${seed3} 
fix ThermoLng all langevin 0.0 0.05 1 2010 
run ${stepsheat}
run 500
WARNING: Using a manybody potential with bonds/angles/dihedrals and special_bond exclusions (src/pair.cpp:250)
Hybrid pair style last /omp style table/omp
Last active /omp style is angle_style harmonic/omp
Neighbor list info ...
  update: every = 1 steps, delay = 0 steps, check = yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 2.92
  ghost atom cutoff = 2.92
  binsize = 1.46, bins = 8 8 8
  7 neighbor lists, perpetual/occasional/extra = 6 1 0
  (1) pair zero, perpetual, skip from (7)
      attributes: half, newton on, omp
      pair build: skip/omp
      stencil: none
      bin: none
  (2) pair lj/cut/omp, perpetual, skip from (7)
      attributes: half, newton on, omp
      pair build: skip/omp
      stencil: none
      bin: none
  (3) pair table/omp, perpetual, skip from (7)
      attributes: half, newton on, omp
      pair build: skip/omp
      stencil: none
      bin: none
  (4) pair threebody/table, perpetual, skip from (6)
      attributes: full, newton on, omp
      pair build: skip/omp
      stencil: none
      bin: none
  (5) compute aggregate/atom, occasional, copy from (6)
      attributes: full, newton on, omp
      pair build: copy
      stencil: none
      bin: none
  (6) neighbor class addition, perpetual
      attributes: full, newton on, omp
      pair build: full/bin/omp
      stencil: full/bin/3d
      bin: standard
  (7) neighbor class addition, perpetual, half/full from (6)
      attributes: half, newton on, omp
      pair build: halffull/newton/omp
      stencil: none
      bin: none
Per MPI rank memory allocation (min/avg/max) = 19.65 | 19.65 | 19.65 Mbytes
   Step          Temp          E_pair         E_mol          TotEng         Press     
         0   0              0              0.14368384     0.14368384    -0.27679535   
       500   0.024751716    0              0.079069322    0.11608087     0.17115377   
Loop time of 0.0649601 on 1 procs for 500 steps with 320 atoms

Performance: 665023.156 tau/day, 7697.027 timesteps/s, 2.463 Matom-step/s
98.0% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.014851   | 0.014851   | 0.014851   |   0.0 | 22.86
Bond    | 0.0074751  | 0.0074751  | 0.0074751  |   0.0 | 11.51
Neigh   | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 0.0012415  | 0.0012415  | 0.0012415  |   0.0 |  1.91
Output  | 1.8175e-05 | 1.8175e-05 | 1.8175e-05 |   0.0 |  0.03
Modify  | 0.041038   | 0.041038   | 0.041038   |   0.0 | 63.17
Other   |            | 0.0003364  |            |       |  0.52

Nlocal:            320 ave         320 max         320 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:            891 ave         891 max         891 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:         4560 ave        4560 max        4560 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 4560
Ave neighs/atom = 14.25
Ave special neighs/atom = 2.3125
Neighbor list builds = 0
Dangerous builds = 0

unfix ThermoLng

# Now we let the system to create the polymeric network
fix ThermoLng all langevin ${temp} ${temp} ${damp} ${seed3} # Brownian Dynamics: langevin + nve
fix ThermoLng all langevin 0.05 ${temp} ${damp} ${seed3} 
fix ThermoLng all langevin 0.05 0.05 ${damp} ${seed3} 
fix ThermoLng all langevin 0.05 0.05 1 ${seed3} 
fix ThermoLng all langevin 0.05 0.05 1 2010 
run ${steps}
run 800
WARNING: Using a manybody potential with bonds/angles/dihedrals and special_bond exclusions (src/pair.cpp:250)
Hybrid pair style last /omp style table/omp
Last active /omp style is angle_style harmonic/omp
Per MPI rank memory allocation (min/avg/max) = 23.67 | 23.67 | 23.67 Mbytes
   Step          Temp          E_pair         E_mol          TotEng         Press     
       500   0.024751716    0              0.079069322    0.11608087     0.17115377   
      1000   0.05698266     2.7357956e-05  0.044098387    0.12933263    -0.099836844  
      1300   0.067592363    7.4645102e-05  0.025764285    0.12691064     0.028897733  
Loop time of 0.0999363 on 1 procs for 800 steps with 320 atoms

Performance: 691640.603 tau/day, 8005.100 timesteps/s, 2.562 Matom-step/s
96.4% CPU use with 1 MPI tasks x 1 OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0.022773   | 0.022773   | 0.022773   |   0.0 | 22.79
Bond    | 0.011472   | 0.011472   | 0.011472   |   0.0 | 11.48
Neigh   | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 0.0019274  | 0.0019274  | 0.0019274  |   0.0 |  1.93
Output  | 2.8003e-05 | 2.8003e-05 | 2.8003e-05 |   0.0 |  0.03
Modify  | 0.06323    | 0.06323    | 0.06323    |   0.0 | 63.27
Other   |            | 0.0005063  |            |       |  0.51

Nlocal:            320 ave         320 max         320 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:            895 ave         895 max         895 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:              0 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:         4518 ave        4518 max        4518 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 4518
Ave neighs/atom = 14.11875
Ave special neighs/atom = 2.3125
Neighbor list builds = 0
Dangerous builds = 0

# Write data for deformation

write_restart ${Dir}/${file6_name}
write_restart /home/franvt/GitRepos/molDynLammps/polymericGels/gel-bonds-1/data/0.050.40.1100-2026-01-15-134529/${file6_name}
write_restart /home/franvt/GitRepos/molDynLammps/polymericGels/gel-bonds-1/data/0.050.40.1100-2026-01-15-134529/data.hydrogel
System init for write_restart ...
WARNING: Using a manybody potential with bonds/angles/dihedrals and special_bond exclusions (src/pair.cpp:250)
Hybrid pair style last /omp style table/omp
Last active /omp style is angle_style harmonic/omp
Total wall time: 0:00:15
